(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{342:function(t,a,s){"use strict";s.r(a);var e=s(4),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"使用-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-cli"}},[t._v("#")]),t._v(" 使用 CLI")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E5%85%B3%E4%BA%8ETypeScript%E7%BC%96%E5%86%99%E5%AE%9E%E4%BD%93%E7%9A%84%E8%AF%B4%E6%98%8E"}},[t._v("关于TypeScript编写实体的说明")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84TypeORM%E9%A1%B9%E7%9B%AE"}},[t._v("初始化一个新的TypeORM项目")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E5%AE%9E%E4%BD%93"}},[t._v("创建一个新实体")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E8%AE%A2%E9%98%85%E8%80%85"}},[t._v("创建一个新订阅者")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%88%9B%E5%BB%BA%E6%96%B0%E8%BF%81%E7%A7%BB"}},[t._v("创建新迁移")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E4%BB%8E%E7%8E%B0%E6%9C%89%E8%A1%A8%E7%BB%93%E6%9E%84%E7%94%9F%E6%88%90%E8%BF%81%E7%A7%BB"}},[t._v("从现有表结构生成迁移")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E8%BF%90%E8%A1%8C%E8%BF%81%E7%A7%BB"}},[t._v("运行迁移")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E8%BF%98%E5%8E%9F%E8%BF%81%E7%A7%BB"}},[t._v("还原迁移")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9E%B6%E6%9E%84"}},[t._v("同步数据库架构")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E8%AE%B0%E5%BD%95%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9E%B6%E6%9E%84%E6%9F%A5%E8%AF%A2%E8%80%8C%E4%B8%8D%E8%BF%90%E8%A1%8C"}},[t._v("记录同步数据库架构查询而不运行")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9E%B6%E6%9E%84"}},[t._v("删除数据库架构")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E8%BF%90%E8%A1%8C%E4%BB%BB%E6%84%8FSQL%E6%9F%A5%E8%AF%A2"}},[t._v("运行任意SQL查询")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98"}},[t._v("清除缓存")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E6%A3%80%E6%9F%A5%E7%89%88%E6%9C%AC"}},[t._v("检查版本")])])]),t._v(" "),s("h2",{attrs:{id:"关于typescript编写实体的说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于typescript编写实体的说明"}},[t._v("#")]),t._v(" 关于TypeScript编写实体的说明")]),t._v(" "),s("p",[t._v("此 CLI 工具使用 javascript 编写，并在 node 上运行。如果你的实体文件是 TypeScript 编写，则需要在使用 CLI 之前将它们转换为 javascript。如果只使用 javascript，则可以跳过此部分。")]),t._v(" "),s("p",[t._v("全局安装 ts-node：")]),t._v(" "),s("p",[t._v("你可以在项目中设置 ts-node 以简化操作，如下所示：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("npm install -g ts-node\n")])])]),s("p",[t._v("在 package.json 中的 scripts 下添加 typeorm 命令")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('"script" {\n    ...\n    "typeorm": "ts-node -r tsconfig-paths/register ./node_modules/typeorm/cli.js"\n}\n')])])]),s("p",[t._v("然后运行如下命令：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("npm run typeorm migration:run\n")])])]),s("p",[t._v("如果你需要将带有破折号的参数传递给 npm 脚本，则需要在"),s("code",[t._v("--")]),t._v("之后添加。例如，如果需要生成，则命令如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("npm run typeorm migration:generate -- -n migrationNameHere\n")])])]),s("h2",{attrs:{id:"初始化一个新的typeorm项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化一个新的typeorm项目"}},[t._v("#")]),t._v(" 初始化一个新的TypeORM项目")]),t._v(" "),s("p",[t._v("你可以使用已设置的所有内容创建新项目：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm init\n")])])]),s("p",[t._v("它使用 TypeORM 创建基本项目所需的所有文件：")]),t._v(" "),s("ul",[s("li",[t._v(".gitignore")]),t._v(" "),s("li",[t._v("package.json")]),t._v(" "),s("li",[t._v("README.md")]),t._v(" "),s("li",[t._v("tsconfig.json")]),t._v(" "),s("li",[t._v("ormconfig.json")]),t._v(" "),s("li",[t._v("src/entity/User.ts")]),t._v(" "),s("li",[t._v("src/index.ts")])]),t._v(" "),s("p",[t._v("然后你可以运行"),s("code",[t._v("npm install")]),t._v("来安装所有依赖项。\n一旦安装了所有依赖项，你需要修改"),s("code",[t._v("ormconfig.json")]),t._v("并插入您自己的数据库设置。\n之后，可以通过运行"),s("code",[t._v("npm start")]),t._v("来运行您的应用程序。")]),t._v(" "),s("p",[t._v("所有文件都在当前目录中生成。\n如果要在特殊目录中生成它们，可以使用"),s("code",[t._v("--name")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm init --name my-project\n")])])]),s("p",[t._v("要指定使用的特定数据库，可以使用"),s("code",[t._v("--database")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm init --database mssql\n")])])]),s("p",[t._v("你还可以使用 Express 生成基础项目：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm init --name my-project --express\n")])])]),s("p",[t._v("如果你使用的是 docker，可以使用以下命令生成"),s("code",[t._v("docker-compose.yml")]),t._v("文件：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm init --docker\n")])])]),s("p",[s("code",[t._v("typeorm init")]),t._v("是设置 TypeORM 项目最简单，最快捷的方法。")]),t._v(" "),s("h2",{attrs:{id:"创建一个新实体"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建一个新实体"}},[t._v("#")]),t._v(" 创建一个新实体")]),t._v(" "),s("p",[t._v("你可以使用 CLI 创建新实体：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm entity:create -n User\n")])])]),s("p",[t._v("其中"),s("code",[t._v("User")]),t._v("是实体文件和类名。\n运行该命令将在项目的"),s("code",[t._v("entitiesDir")]),t._v("中创建一个新的空实体。\n要设置项目的"),s("code",[t._v("entitiesDir")]),t._v("，你必须在连接选项中添加它：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('{\n    cli: {\n        entitiesDir: "src/entity"\n    }\n}\n')])])]),s("p",[t._v("学习更多关于 "),s("router-link",{attrs:{to:"/_posts/typeromdoc/connection-options.html"}},[t._v("connection options")]),t._v(".")],1),t._v(" "),s("p",[t._v("如果多个目录中具有多个实体的多模块项目结构，则需要提供 CLI 生成实体目录的路径：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm entity:create -n User -d src/user/entity\n")])])]),s("p",[t._v("学习更多关于 "),s("router-link",{attrs:{to:"/_posts/typeromdoc/entities.html"}},[t._v("entities")]),t._v(".")],1),t._v(" "),s("h2",{attrs:{id:"创建一个新订阅者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建一个新订阅者"}},[t._v("#")]),t._v(" 创建一个新订阅者")]),t._v(" "),s("p",[t._v("可以使用 CLI 创建新订阅者：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm subscriber:create -n UserSubscriber\n")])])]),s("p",[t._v("其中"),s("code",[t._v("UserSubscriber")]),t._v("是订阅者文件和类名。\n执行以下命令将在项目的"),s("code",[t._v("subscribersDir")]),t._v("中创建一个新的空订阅者。\n要设置"),s("code",[t._v("subscribersDir")]),t._v("，首先必须在连接选项中添加它：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('{\n    cli: {\n        subscribersDir: "src/subscriber"\n    }\n}\n')])])]),s("p",[t._v("了解有关"),s("router-link",{attrs:{to:"/_posts/typeromdoc/connection-options.html"}},[t._v("连接选项")]),t._v("的更多信息。\n如果你有一个不同目录中有多个订阅用户的多模块结构的项目，可以给 CLI 命令提供相应的路径，然后在其中生成 subscriber：")],1),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm subscriber:create -n UserSubscriber -d src/user/subscriber\n")])])]),s("p",[t._v("了解有关"),s("router-link",{attrs:{to:"/_posts/typeromdoc/listeners-and-subscribers.html"}},[t._v("Subscribers")]),t._v("的更多信息。")],1),t._v(" "),s("h2",{attrs:{id:"创建新迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建新迁移"}},[t._v("#")]),t._v(" 创建新迁移")]),t._v(" "),s("p",[t._v("你可以使用 CLI 创建新的迁移：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm migration:create -n UserMigration\n")])])]),s("p",[t._v("其中"),s("code",[t._v("UserMigration")]),t._v("是一个迁移文件和类名。\n运行该命令将在项目的"),s("code",[t._v("migrationsDir")]),t._v("中创建一个新的空迁移。\n要设置"),s("code",[t._v("migrationsDir")]),t._v("，首先必须在连接选项中添加它：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('{\n    cli: {\n        migrationsDir: "src/migration"\n    }\n}\n')])])]),s("p",[t._v("了解有关"),s("router-link",{attrs:{to:"/_posts/typeromdoc/connection-options.html"}},[t._v("连接选项")]),t._v("的更多信息。\n如果你有一个在不同目录中具有多个迁移的多模块结构的项目，则可以提供要生成迁移的 CLI 命令的路径：")],1),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm migration:create -n UserMigration -d src/user/migration\n")])])]),s("p",[t._v("了解有关"),s("router-link",{attrs:{to:"/_posts/typeromdoc/migrations.html"}},[t._v("Migrations")]),t._v("的更多信息。")],1),t._v(" "),s("h2",{attrs:{id:"从现有表结构生成迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从现有表结构生成迁移"}},[t._v("#")]),t._v(" 从现有表结构生成迁移")]),t._v(" "),s("p",[t._v("自动迁移生成会创建新的迁移文件并编写必须执行的所有 sql 查询以更新数据库。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm migration:generate -n UserMigration\n")])])]),s("p",[t._v("根据经验，在每次实体更改后生成迁移。")]),t._v(" "),s("p",[t._v("了解有关"),s("router-link",{attrs:{to:"/_posts/typeromdoc/migrations.html"}},[t._v("Migrations")]),t._v("的更多信息。")],1),t._v(" "),s("h2",{attrs:{id:"运行迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行迁移"}},[t._v("#")]),t._v(" 运行迁移")]),t._v(" "),s("p",[t._v("要执行所有挂起的迁移，请使用以下命令：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm migration:run\n")])])]),s("p",[t._v("了解有关 "),s("router-link",{attrs:{to:"/_posts/typeromdoc/migrations.html"}},[t._v("Migrations")]),t._v("的更多信息。")],1),t._v(" "),s("h2",{attrs:{id:"还原迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#还原迁移"}},[t._v("#")]),t._v(" 还原迁移")]),t._v(" "),s("p",[t._v("要还原最近执行的迁移，请使用以下命令：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm migration:revert\n")])])]),s("p",[t._v("此命令将仅撤消上次执行的迁移。\n你可以多次执行此命令以还原多个迁移。\n了解有关"),s("router-link",{attrs:{to:"/_posts/typeromdoc/migrations.html"}},[t._v("Migrations")]),t._v("的更多信息。")],1),t._v(" "),s("h2",{attrs:{id:"同步数据库架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同步数据库架构"}},[t._v("#")]),t._v(" 同步数据库架构")]),t._v(" "),s("p",[t._v("要同步数据库架构，请使用：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm schema:sync\n")])])]),s("p",[t._v("在生产环境中请谨慎运行此命令。如果冒失的使用它，则可能会导致数据库同步时数据丢失。在部署生产环境之前，检查将运行哪些 sql 查询。")]),t._v(" "),s("h2",{attrs:{id:"记录同步数据库架构查询而不运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#记录同步数据库架构查询而不运行"}},[t._v("#")]),t._v(" 记录同步数据库架构查询而不运行")]),t._v(" "),s("p",[t._v("要检查将要运行的 sql 查询，请使用"),s("code",[t._v("schema：sync")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm schema:log\n")])])]),s("h2",{attrs:{id:"删除数据库架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除数据库架构"}},[t._v("#")]),t._v(" 删除数据库架构")]),t._v(" "),s("p",[t._v("要完全删除数据库架构，请使用以下命令：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm schema:drop\n")])])]),s("p",[t._v("在生产环境时要谨慎使用这个命令，因为它会完全删除数据库中的数据。")]),t._v(" "),s("h2",{attrs:{id:"运行任意sql查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行任意sql查询"}},[t._v("#")]),t._v(" 运行任意SQL查询")]),t._v(" "),s("p",[t._v("你可以使用以下命令直接在数据库中执行想要的任何 SQL 查询：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('typeorm query "SELECT * FROM USERS"\n')])])]),s("h2",{attrs:{id:"清除缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清除缓存"}},[t._v("#")]),t._v(" 清除缓存")]),t._v(" "),s("p",[t._v("如果你使用"),s("code",[t._v("QueryBuilder")]),t._v("缓存，有时可能希望清除缓存中存储的所有内容。\n则可以使用以下命令执行此操作：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm cache:clear\n")])])]),s("h2",{attrs:{id:"检查版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#检查版本"}},[t._v("#")]),t._v(" 检查版本")]),t._v(" "),s("p",[t._v("可以通过运行以下命令来检查已安装（本地和全局）的 typeorm 版本：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("typeorm version\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);